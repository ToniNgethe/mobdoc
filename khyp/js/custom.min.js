/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

$(document).ready(function () {

    var base_url = "http://localhost/mobdoc/";

    //var base_url = "http://mobdoc.crescentke.com/";


    //Default search results on homepage
    document.getElementById("main-page").onload = function (event) {
        event.preventDefault();
        var zip = $("#zipcode").val();
        $.ajax({
            method: "POST",
            url: base_url + "search",
            dataType: 'text',
            data: {zipcode: zip},
            success: function (res) {
                $('#results').html(res);
            }
        });
    };

    //search
    $("#search-form").submit(function (event) {
        event.preventDefault();
        var zip = $("#zipcode").val();
        $.ajax({
            method: "POST",
            url: base_url + "search",
            dataType: 'text',
            data: {zipcode: zip},
            success: function (res) {
                $('#results').html(res);
            }
        });
    });



    //Filter by specialty
    $('.filter-for select').change(function (event) {
        event.preventDefault();

        var specialty = $("select#specialty").val();
        var zip = $("#zipcode").val();
        var insurance = $("#insurance").val();
        var fee = $("#fee").val();
        $.ajax({
            method: "POST",
            url: base_url + "filtersearch",
            dataType: 'text',
            data: {zipcode: zip, specialty: specialty, insurance: insurance, fee: fee},
            success: function (res) {
                $('#results').html(res);
            }
        });
    });

    //Filter by provider
    $('#filter-provider').submit(function (event) {
        event.preventDefault();

        var filterdate = $("#filterdate").val();
        var specialistId = $("#specialistId").val();
        $.ajax({
            method: "POST",
            url: base_url + "filterprovider",
            dataType: 'text',
            data: {filterdate: filterdate, specialistId: specialistId},
            success: function (res) {
                $('#timeslot-results').html(res);
            }
        });
    });



    //Show login
    $("#signin-sc").on('click', function () {
        $("#startJoin").addClass('hidden');
        $("#startLogin").removeClass('hidden');
    });


    //Show signup
    $("#signup-sc").on('click', function () {
        $("#startJoin").removeClass('hidden');
        $("#startLogin").addClass('hidden');
    });


    //Book appointment
    $("#reserve-form").submit(function (event) {
        event.preventDefault();
        var placedBy = $("#placedBy").val();
        var providerKey = $("#providerKey").val();
        var scheduleKey = $("#scheduleKey").val();
        var visitReason = $("#visitReason").val();
        var visitBefore = $("#visitBefore").val();
        var visitName = $("#visitName").val();
        var visitEmail = $("#visitEmail").val();
        var visitPhone = $("#visitPhone").val();
        var visitLocation = $("#visitLocation").val();
        var visitOther = $("#visitOther").val();
        var visitBill = $("#visitBill").val();
        var visitMore = $("#visitMore").val();
        jQuery.ajax({
            type: "POST",
            url: base_url + "reserve",
            dataType: 'json',
            data: {visitBill: visitBill, visitMore: visitMore, placedBy: placedBy, providerKey: providerKey, scheduleKey: scheduleKey, visitReason: visitReason, visitBefore: visitBefore, visitName: visitName, visitEmail: visitEmail, visitPhone: visitPhone, visitLocation: visitLocation, visitOther: visitOther},
            success: function (res) {
                if (res.status === "true")
                {
                    window.location = base_url + res.red_url;
                } else {
                    $("#errorMessage").empty().addClass('alert alert-danger').append(res.error);
                }
            }
        });
    });

    //Reschedule appointment
    $("#rev").submit(function (event) {
        event.preventDefault();
        var edittimeslot = $("#edittimeslot").val();
        var appKey = $("#appKey").val();
        jQuery.ajax({
            type: "POST",
            url: base_url + "reschedule",
            dataType: 'json',
            data: {edittimeslot: edittimeslot, appKey: appKey},
            success: function (res) {
                if (res.status === "true")
                {
                    $("#errorMessage").empty().addClass('alert alert-success').append(res.success);
                } else {
                    $("#errorMessage").empty().addClass('alert alert-danger').append(res.error);
                }
            }
        });
    });

});

jQuery(document).ready(function ($) {
    $(".clickable-row").click(function () {
        window.location = $(this).data("href");
    });
});


function initAutocomplete() {

    new google.maps.places.Autocomplete(
            (document.getElementById('pzip')),
            {types: ['geocode']});

}